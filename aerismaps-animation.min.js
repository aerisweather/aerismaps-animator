/*! AerisMaps.Animation 2016-03-24 */
!function(a,b){"use strict";function c(a){this.message=a,"captureStackTrace"in Error?Error.captureStackTrace(this,c):this.stack=(new Error).stack}var d=a.AerisMaps||{};a.AerisMaps=d;var e=function(a,b){var c,d,e=a||{},f={},g={},h=[],i=[];return e.on=function(a,b,c){f[a]||(f[a]=[]),f[a].push(b),c&&(g[b]=c)},e.off=function(a,b,d){d?(h.push(arguments),c=h.length):f[a]&&f[a].splice(b,1)},e.trigger=function(a,b,j){if(j)return i.push(arguments),void(d=i.length);var k,l,m;if(f[a])for(k=0,l=f[a].length;l>k;)m=f[a][k],m.call(g[m],b),k++;if(c>0){var n;for(k=0;c>k;k+=1)n=h[k],e.off(n[0],n[1],!1);h=[],c=0}if(d>0){var o=i.shift();d=i.length,e.trigger(o[0],o[1])}},b||(e.offAll=function(a,b){for(var c=f[a],d=c.length,g=0;d>g;g+=1)e.off(a,c[g],b)}),e},f=function(a){var c=b.createElement("div"),d=b.createDocumentFragment(),e=null;for(c.innerHTML=a;e=c.firstChild;)d.appendChild(e);return d},g=function(a,b){var c,d=a.ownerDocument.defaultView;return d&&d.getComputedStyle?(b=b.replace(/([A-Z])/g,"-$1").toLowerCase(),d.getComputedStyle(a,null).getPropertyValue(b)):a.currentStyle&&(b=b.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=a.currentStyle[b],/^\d+(em|pt|%|ex)?$/i.test(c))?function(b){var c=a.style.left,d=a.runtimeStyle.left;return a.runtimeStyle.left=a.currentStyle.left,a.style.left=b||0,b=a.style.pixelLeft+"px",a.style.left=c,a.runtimeStyle.left=d,b}(c):c},h=function(a){return this.el=a,this};h.prototype.select=function(a){return h.select(a,this.el)},h.prototype.show=function(){return this.el.style.display="block",this},h.prototype.hide=function(){return this.el.style.display="none",this},h.prototype.visible=function(){return"none"!=this.css("display")},h.prototype.css=function(a,b){if("string"==typeof a){if(null===b)return g(this.el,a);this.el.style[a]=b}else for(var c in a)this.el.style[c]=a[c];return this},h.prototype.addClass=function(a){var b=this.el;if(void 0!==a&&""!==a)if(b.classList)a=a.match(/\s/)?a.split(" "):[a],a.forEach(function(a){b.classList.add(a)});else{var c=b.className;c&&(c+=" "),b.className+=c+a}return this},h.prototype.removeClass=function(a){var b=this.el;if(void 0!==a&&""!==a)if(b.classList)a=a.match(/\s/)?a.split(" "):[a],a.forEach(function(a){b.classList.remove(a)});else{var c=new RegExp("\b"+a+"\b");b.className.replace(c,"")}return this},h.prototype.toggleClass=function(a){return this.hasClass(a)?this.removeClass(a):this.addClass(a),this},h.prototype.hasClass=function(a){if(void 0===a||""===a)return!1;if(this.el.classList)return this.el.classList.contains(a);var b=new RegExp("(^|\\s+)"+a+"(\\s+|$)");return b.test(this.el.className)},h.prototype.create=function(a){var b=a;return"string"==typeof b&&(b=f(a)),void 0===b.ext&&h.extend(b),b},h.prototype.append=function(a){var b=this.create(a);return this.el.appendChild(b),this},h.prototype.prepend=function(a){var c=this.create(a);return b.body.insertBefore(c,this.el.firstChild),this},h.prototype.remove=function(){this.el.parentNode.removeChild(this.el)},h.prototype.empty=function(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild);return this},h.select=function(c,d){if("string"!=typeof c)return c;if(d||(d=b),d!=b&&d!=a){var e=c.match(/^\:scope/);e&&0!=e.length||(c=":scope "+c)}var f=Array.prototype.slice.call(d.querySelectorAll(c));return f.forEach(function(a){h.extend(a)}),1==f.length&&(f=f[0]),f},h.extend=function(a){a.ext=new h(a)},c.prototype=Object.create(Error.prototype),c.prototype.name="InvalidArgumentException",c.prototype.constructor=c;var i=function(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof a[c]&&a.hasOwnProperty(c)&&null!=a[c]?i(a[c],b[c]):a[c]=b[c]);return a},j=function(a){if("object"!=typeof a)return[];var b=[];for(var c in a)hasOwnProperty.call(a,c)&&b.push(c);return b},k=function(a){return a.constructor.toString().indexOf("Date")>-1},l=function(a,b){var c=a.getHours(),d="AM";b.indexOf("t")>-1&&c>12&&(c-=12,d="PM");var e={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":c,"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds(),"t+":d};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var f in e)new RegExp("("+f+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?e[f]:("00"+e[f]).substr((""+e[f]).length)));return b},m=function(a,b){var c=a;for(var d in b)c=c.replace("{{"+d+"}}",b[d]);return c};d.url="http://maps.aerisapi.com/{{client_id}}_{{client_secret}}/{{layers}}/{{size}}/{{loc}},{{zoom}}/{{time}}.{{format}}";var n=function(a,b){var d=this,e=i({loc:null,keys:{id:null,secret:null},refresh:0,events:{click:function(){d.isPaused()||!d.isAnimating()?d.play():d.pause()}},map:{zoom:6,format:"jpg",size:{width:600,height:600},layers:["flat","radar","admin"]},animation:{from:-21600,to:0,duration:2,endDelay:1,intervals:10},overlays:{title:null,timestamp:{format:"MM/dd/yyyy hh:mm tt",continuous:!0}}},b);if(k(e.animation.from)?(this._fromOffset=null,e.animation.from=e.animation.from.getTime()):this._fromOffset=1e3*e.animation.from,k(e.animation.to)?(this._toOffset=null,e.animation.to=e.animation.to.getTime()):this._toOffset=1e3*e.animation.to,this.target="string"==typeof a?h.select(a):h.extend(a),this.config=e,this.duration=e.animation.duration,this._endDelay=e.animation.endDelay,this._from=e.animation.from,this._to=e.animation.to,this._intervals=e.animation.intervals,this._elapsed=0,this._time=this._from,this._increment=0,this._delay=1/60,this._paused=!1,this._images={},this._currentImage=null,!e.keys.id||0==e.keys.id.length||!e.keys.secret||0==e.keys.secret.length)throw new c('Invalid configuration values for "keys.id" and/or "keys.secret"');if(!e.loc||0==e.loc.length)throw new c('Invalid configuration value for "loc"');return this.init(),this};e(n.prototype,!0),n.prototype.init=function(){if(this.target){var a=this;this.target.ext.css({position:"relative",width:this.config.map.size.width+"px",height:this.config.map.size.height+"px"}),this.target.ext.addClass("amp-map"),this.target.ext.append('<div class="amp-map-content"></div>');var b=this.target.ext.select(".amp-map-content");if(b.ext.css({position:"absolute",top:0,left:0,bottom:0,right:0,"z-index":0}),this._contentTarget=b,this.config.events)for(var c in this.config.events)this.target.addEventListener(c,function(){a.config.events[c]()});if(this.config.overlays.timestamp){this.target.ext.append('<div class="amp-map-timestamp"></div>'),this._timestamp=this.target.ext.select(".amp-map-timestamp");var d=this.config.overlays.timestamp;"object"==typeof d&&void 0!==d.continuous&&(d.continuous===!1?this.on("advance:image",function(b){a._updateTimestampOverlay(b.time)}):this.on("advance",function(b){a._updateTimestampOverlay(b.time)})),this.on("load:progress",function(b){a._updateTimestampOverlay(b.time)})}this.config.overlays.title&&this.target.ext.append('<div class="amp-map-title">'+this.config.overlays.title+"</div>")}},n.prototype.play=function(){if(!this.isAnimating()){if(!this._hasImages())return void this._loadData();this._paused=!1,this._updateTiming(),this.trigger("play",{from:new Date(this._from),to:new Date(this._to)}),this._time!=this._to&&this._to!=this._from||this.goToTime(this._from),function(a){a._timer=setInterval(function(){var b=a._time+a._increment;b>a._to?a.restart():a.goToTime(b)},1e3*a._delay)}(this)}},n.prototype.stop=function(){this.pause(),this.trigger("stop"),this._paused=!1,null!=this._to&&this.goToTime(this._to)},n.prototype.restart=function(){this.pause(),function(a){setTimeout(function(){a.goToTime(a._from),a.play()},1e3*a._endDelay)}(this)},n.prototype.pause=function(){this._paused=!0,this._timer&&(a.clearInterval(this._timer),this._timer=null),this.trigger("pause")},n.prototype.goToTime=function(a){this._time=k(a)?a.getTime():a,this._offset=a-this._from;var b=this._imageClosestToTime(this._time);b?b!=this._currentImage&&(b.ext.show(),this._currentImage&&this._currentImage.ext&&this._currentImage.ext.hide(),this._currentImage=b):this.isAnimating()||this._loadInterval(a,!1),this.trigger("advance",{time:this._time,offset:this._offset})},n.prototype.isAnimating=function(){return null!=this._timer},n.prototype.isPaused=function(){return this._paused},n.prototype.totalTime=function(){return this._to-this._from},n.prototype.currentTime=function(){return this._time},n.prototype.position=function(){this._offset/this.totalTime()},n.prototype.startDate=function(){return new Date(this._from)},n.prototype.setStartDate=function(a){this.stop(),this._from=k(a)?a.getTime():a,this._updateTiming(),this._images={}},n.prototype.endDate=function(){return new Date(this._to)},n.prototype.setEndDate=function(a){this.stop(),this._to=k(a)?a.getTime():a,this._updateTiming(),this._images={}},n.prototype._updateTiming=function(){this._increment=(this._to-this._from)/this.duration*this._delay},n.prototype._imageClosestToTime=function(a){var b=null,c=this._from,d=Math.abs(a-c);for(var e in this._images){var f=Math.abs(a-e);d>f&&(d=f,c=e)}return c!=this._lastImageTime&&this._images[c]&&(b=this._images[c],c=Math.round(c),this._lastImageTime=c,this.trigger("advance:image",{time:c,img:b})),b},n.prototype._hasImages=function(){var a=this._images;if(null===a)return!1;var b=!1;for(var c in a)if(hasOwnProperty.call(a,c))return!0;return b},n.prototype._updateTimestampOverlay=function(a){if(this._timestamp){var b=this.config.overlays.timestamp,c=null;"string"==typeof b?c=b:b.format&&(c=b.format),this._timestamp.innerHTML=l(new Date(a),c)}},n.prototype._loadData=function(){var a=(new Date).getTime();null!==this._fromOffset&&(this._from=a+this._fromOffset,this._time=this._from),null!==this._toOffset&&(this._to=a+this._toOffset),this._images={},this._contentTarget.ext.empty();for(var b=this._intervals,c=Math.round((this._to-this._from)/b),d=[],e=null,f=0;b>f;f++){var g=this._from+c*f;0!=f&&g==e||(d.push(g),e=g)}this._intervals=d.length,this.trigger("load:start",{times:d});var h=this,i=0,j=function(){h._loadInterval(d[i],!0,function(){i++,i>=d.length?(h.trigger("load:done"),h.play(),h.config.refresh>0&&setTimeout(function(){h.stop(),h._loadData()},1e3*h.config.refresh)):j()})};j()},n.prototype._loadInterval=function(a,b,c){var e=this.config,f=new Date(a),g=new Date(f.getTime()+60*f.getTimezoneOffset()*1e3),i=m(d.url,{client_id:e.keys.id,client_secret:e.keys.secret,layers:e.map.layers.join(","),zoom:e.map.zoom,size:e.map.size.width+"x"+e.map.size.height,loc:e.loc,format:e.map.format,time:l(g,"yyyyMMddhhmm00")}),k=new Image;k.src=i,function(d){k.onload=function(){d._images||(d._images={});var e='<img id="amp-'+a+'" src="'+k.src+'" width="'+d.config.map.size.width+'" height="'+d.config.map.size.height+'" style="position:absolute;">';d._contentTarget.ext.append(e);var f=h.select("#amp-"+a);f&&b&&(d._images[a]=f),d._currentImage&&d._currentImage.ext&&d._currentImage.ext.hide(),d._currentImage=f,d.trigger("load:image",{date:new Date(a),src:k.src}),d.trigger("load:progress",{time:a,loaded:j(d._images).length,total:d._intervals}),c&&c()}}(this)},a.AerisMaps.Animation=n}(window,document);