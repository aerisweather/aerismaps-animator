/*! AerisMaps.Animation 2016-03-30 */
!function(a,b){"use strict";function c(a){this.message=a,"captureStackTrace"in Error?Error.captureStackTrace(this,c):this.stack=(new Error).stack}var d=a.AerisMaps||{};a.AerisMaps=d;var e=function(a,b){for(var c in b)b.hasOwnProperty(c)&&("object"==typeof a[c]&&a.hasOwnProperty(c)&&null!=a[c]?e(a[c],b[c]):a[c]=b[c]);return a},f=function(a){if("object"!=typeof a)return[];var b=[];for(var c in a)hasOwnProperty.call(a,c)&&b.push(c);return b},g=function(a){return a.constructor.toString().indexOf("Date")>-1},h=function(a,b){var c=a.getHours(),d="AM";b.indexOf("t")>-1&&c>12&&(c-=12,d="PM");var e={"M+":a.getMonth()+1,"d+":a.getDate(),"h+":c,"m+":a.getMinutes(),"s+":a.getSeconds(),"q+":Math.floor((a.getMonth()+3)/3),S:a.getMilliseconds(),"t+":d};/(y+)/.test(b)&&(b=b.replace(RegExp.$1,(a.getFullYear()+"").substr(4-RegExp.$1.length)));for(var f in e)new RegExp("("+f+")").test(b)&&(b=b.replace(RegExp.$1,1==RegExp.$1.length?e[f]:("00"+e[f]).substr((""+e[f]).length)));return b},i=function(a,b){var c=a;for(var d in b)c=c.replace("{{"+d+"}}",b[d]);return c},j=function(a,b){var c,d=-1,e=a.length,f=b[0],g=b[1],h=b[2];switch(b.length){case 0:for(;++d<e;)(c=a[d]).callback.call(c.ctx);return;case 1:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f);return;case 2:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g);return;case 3:for(;++d<e;)(c=a[d]).callback.call(c.ctx,f,g,h);return;default:for(;++d<e;)(c=a[d]).callback.apply(c.ctx,b);return}},k={on:function(a,b,c){this._events||(this._events={});var d=this._events[a]||(this._events[a]=[]);return d.push({callback:b,context:c,ctx:c||this}),this},once:function(a,b,c){var d=this,e=_.once(function(){d.off(a,e),b.apply(this,arguments)});return e._callback=b,this.on(a,e,c)},off:function(a,b,c){if(!a&&!b&&!c)return this._events=void 0,this;for(var d,e=a?[a]:_.keys(this._events),f=0,g=e.lenght;g>f;f++){d=e[f];var h=this._events[d];if(h)if(b||c){for(var i=[],j=0,k=h.length;k>j;j++){var l=h[j];(b&&b!==l.callback&&b!==l.callback._callback||c&&c!==l.context)&&i.push(l)}i.length?this._events[d]=i:delete this._events[d]}else delete this._events[d]}return this},trigger:function(a){if(!this._events)return this;var b=arguments||[],c="[object Array]"===Object.prototype.toString.call(b);if(!c){for(var d=[],e=f(b),g=0,h=e.length;h>g;g++)d.push(b[e[g]]);b=d}b=b.slice(1);var i=this._events[a],k=this._events.all;return i&&j(i,b),k&&j(k,arguments),this}},l=function(a){var c=b.createElement("div"),d=b.createDocumentFragment(),e=null;for(c.innerHTML=a;e=c.firstChild;)d.appendChild(e);return d},m=function(a,b){var c,d=a.ownerDocument.defaultView;return d&&d.getComputedStyle?(b=b.replace(/([A-Z])/g,"-$1").toLowerCase(),d.getComputedStyle(a,null).getPropertyValue(b)):a.currentStyle&&(b=b.replace(/\-(\w)/g,function(a,b){return b.toUpperCase()}),c=a.currentStyle[b],/^\d+(em|pt|%|ex)?$/i.test(c))?function(b){var c=a.style.left,d=a.runtimeStyle.left;return a.runtimeStyle.left=a.currentStyle.left,a.style.left=b||0,b=a.style.pixelLeft+"px",a.style.left=c,a.runtimeStyle.left=d,b}(c):c},n=function(a){return this.el=a,this};n.prototype.select=function(a){return n.select(a,this.el)},n.prototype.show=function(){return this.el.style.display="block",this},n.prototype.hide=function(){return this.el.style.display="none",this},n.prototype.visible=function(){return"none"!=this.css("display")},n.prototype.css=function(a,b){if("string"==typeof a){if(null===b)return m(this.el,a);this.el.style[a]=b}else for(var c in a)this.el.style[c]=a[c];return this},n.prototype.addClass=function(a){var b=this.el;if(void 0!==a&&""!==a)if(b.classList)a=a.match(/\s/)?a.split(" "):[a],a.forEach(function(a){b.classList.add(a)});else{var c=b.className;c&&(c+=" "),b.className+=c+a}return this},n.prototype.removeClass=function(a){var b=this.el;if(void 0!==a&&""!==a)if(b.classList)a=a.match(/\s/)?a.split(" "):[a],a.forEach(function(a){b.classList.remove(a)});else{var c=new RegExp("\b"+a+"\b");b.className.replace(c,"")}return this},n.prototype.toggleClass=function(a){return this.hasClass(a)?this.removeClass(a):this.addClass(a),this},n.prototype.hasClass=function(a){if(void 0===a||""===a)return!1;if(this.el.classList)return this.el.classList.contains(a);var b=new RegExp("(^|\\s+)"+a+"(\\s+|$)");return b.test(this.el.className)},n.prototype.create=function(a){var b=a;return"string"==typeof b&&(b=l(a)),void 0===b.ext&&n.extend(b),b},n.prototype.append=function(a){var b=this.create(a);return this.el.appendChild(b),this},n.prototype.prepend=function(a){var c=this.create(a);return b.body.insertBefore(c,this.el.firstChild),this},n.prototype.remove=function(){this.el.parentNode.removeChild(this.el)},n.prototype.empty=function(){for(;this.el.firstChild;)this.el.removeChild(this.el.firstChild);return this},n.select=function(c,d){if("string"!=typeof c)return c;if(d||(d=b),d!=b&&d!=a){var e=c.match(/^\:scope/);e&&0!=e.length||(c=":scope "+c)}var f=Array.prototype.slice.call(d.querySelectorAll(c));return f.forEach(function(a){n.extend(a)}),1==f.length&&(f=f[0]),f},n.extend=function(a){a.ext=new n(a)},c.prototype=Object.create(Error.prototype),c.prototype.name="InvalidArgumentException",c.prototype.constructor=c,d.url="//{{server}}/{{client_id}}_{{client_secret}}/{{layers}}/{{size}}/{{loc}},{{zoom}}/{{time}}.{{format}}";var o=function(a,b){var d=this,f=e({server:"maps.aerisapi.com",loc:null,keys:{id:null,secret:null},refresh:0,autoplay:!1,events:{click:function(){d.isPaused()||!d.isAnimating()?d.play():d.pause()}},map:{zoom:6,format:"jpg",size:{width:600,height:600},layers:["flat","radar","admin"]},animation:{from:-21600,to:0,duration:2,endDelay:1,intervals:10},overlays:{title:null,timestamp:{format:"MM/dd/yyyy hh:mm tt",continuous:!0}}},b);if(g(f.animation.from)?(this._fromOffset=null,f.animation.from=f.animation.from.getTime()):this._fromOffset=1e3*f.animation.from,g(f.animation.to)?(this._toOffset=null,f.animation.to=f.animation.to.getTime()):this._toOffset=1e3*f.animation.to,this.target="string"==typeof a?n.select(a):n.extend(a),this.config=f,this.duration=f.animation.duration,this._endDelay=f.animation.endDelay,this._from=f.animation.from,this._to=f.animation.to,this._intervals=f.animation.intervals,this._elapsed=0,this._time=this._from,this._increment=0,this._delay=1/60,this._paused=!1,this._images={},this._currentImage=null,!f.keys.id||0==f.keys.id.length||!f.keys.secret||0==f.keys.secret.length)throw new c('Invalid configuration values for "keys.id" and/or "keys.secret"');if(!f.loc||0==f.loc.length)throw new c('Invalid configuration value for "loc"');return this.init(),this};e(o.prototype,k),o.prototype.init=function(){if(this.target){var a=this;this.target.ext.css({position:"relative",width:this.config.map.size.width+"px",height:this.config.map.size.height+"px"}),this.target.ext.addClass("amp-map"),this.target.ext.append('<div class="amp-map-content"></div>');var b=this.target.ext.select(".amp-map-content");if(b.ext.css({position:"absolute",top:0,left:0,bottom:0,right:0,"z-index":0}),this._contentTarget=b,this.config.events)for(var c in this.config.events)this.target.addEventListener(c,function(){a.config.events[c]()});if(this.config.overlays.timestamp){this.target.ext.append('<div class="amp-map-timestamp"></div>'),this._timestamp=this.target.ext.select(".amp-map-timestamp");var d=this.config.overlays.timestamp;"object"==typeof d&&void 0!==d.continuous&&(d.continuous===!1?this.on("advance:image",function(b){a._updateTimestampOverlay(b.time)}):this.on("advance",function(b){a._updateTimestampOverlay(b.time)})),this.on("load:progress",function(b){a._updateTimestampOverlay(b.time)})}if(this.config.overlays.title&&this.target.ext.append('<div class="amp-map-title">'+this.config.overlays.title+"</div>"),this.config.autoplay)this.play();else{var e=(new Date).getTime(),f=void 0!==this._fromOffset?e+this._fromOffset:this._from,g=void 0!==this._toOffset?e+this._toOffset:this._to,h=e;f>=e?h=f:e>=g&&(h=g),this.goToTime(h)}}},o.prototype.play=function(){if(!this.isAnimating()){if(!this._hasImages())return void this._loadData();this._paused=!1,this._updateTiming(),this.trigger("play",{from:new Date(this._from),to:new Date(this._to)}),this._time!=this._to&&this._to!=this._from||this.goToTime(this._from),function(a){a._timer=setInterval(function(){var b=a._time+a._increment;b>a._to?a.restart():a.goToTime(b)},1e3*a._delay)}(this)}},o.prototype.stop=function(){this.pause(),this.trigger("stop"),this._paused=!1,null!=this._to&&this.goToTime(this._to)},o.prototype.restart=function(){this.pause(),function(a){setTimeout(function(){a.goToTime(a._from),a.play()},1e3*a._endDelay)}(this)},o.prototype.pause=function(){this._paused=!0,this._timer&&(a.clearInterval(this._timer),this._timer=null),this.trigger("pause")},o.prototype.goToTime=function(a){this._time=g(a)?a.getTime():a,this._offset=a-this._from;var b=this._imageClosestToTime(this._time);b?b!=this._currentImage&&(b.ext.show(),this._currentImage&&this._currentImage.ext&&this._currentImage.ext.hide(),this._currentImage=b):this.isAnimating()||this._loadInterval(a,!1),this.trigger("advance",{time:this._time,offset:this._offset})},o.prototype.isAnimating=function(){return null!=this._timer},o.prototype.isPaused=function(){return this._paused},o.prototype.totalTime=function(){return this._to-this._from},o.prototype.currentTime=function(){return this._time},o.prototype.position=function(){this._offset/this.totalTime()},o.prototype.startDate=function(){return new Date(this._from)},o.prototype.setStartDate=function(a){this.stop(),this._from=g(a)?a.getTime():a,this._updateTiming(),this._images={}},o.prototype.endDate=function(){return new Date(this._to)},o.prototype.setEndDate=function(a){this.stop(),this._to=g(a)?a.getTime():a,this._updateTiming(),this._images={}},o.prototype._updateTiming=function(){this._increment=(this._to-this._from)/this.duration*this._delay},o.prototype._imageClosestToTime=function(a){var b=null,c=this._from,d=Math.abs(a-c);for(var e in this._images){var f=Math.abs(a-e);d>f&&(d=f,c=e)}return c!=this._lastImageTime&&this._images[c]&&(b=this._images[c],c=Math.round(c),this._lastImageTime=c,this.trigger("advance:image",{time:c,img:b})),b},o.prototype._hasImages=function(){var a=this._images;if(null===a)return!1;var b=!1;for(var c in a)if(hasOwnProperty.call(a,c))return!0;return b},o.prototype._updateTimestampOverlay=function(a){if(this._timestamp){var b=this.config.overlays.timestamp,c=null;"string"==typeof b?c=b:b.format&&(c=b.format),this._timestamp.innerHTML=h(new Date(a),c)}},o.prototype._loadData=function(){var a=(new Date).getTime();null!==this._fromOffset&&(this._from=a+this._fromOffset,this._time=this._from),null!==this._toOffset&&(this._to=a+this._toOffset),this._images={},this._contentTarget.ext.empty();for(var b=this._intervals,c=Math.round((this._to-this._from)/b),d=[],e=null,f=0;b>f;f++){var g=this._from+c*f;0!=f&&g==e||(d.push(g),e=g)}this._intervals=d.length,this.trigger("load:start",{times:d});var h=this,i=0,j=function(){h._loadInterval(d[i],!0,function(){i++,i>=d.length?(h.trigger("load:done"),h.play(),h.config.refresh>0&&setTimeout(function(){h.stop(),h._loadData()},1e3*h.config.refresh)):j()})};j()},o.prototype._loadInterval=function(a,b,c){var e=this.config,g=new Date(a),j=new Date(g.getTime()+60*g.getTimezoneOffset()*1e3),k=i(d.url,{server:e.server,client_id:e.keys.id,client_secret:e.keys.secret,layers:e.map.layers.join(","),zoom:e.map.zoom,size:e.map.size.width+"x"+e.map.size.height,loc:e.loc,format:e.map.format,time:h(j,"yyyyMMddhhmm00")}),l=new Image;l.src=k,function(d){l.onload=function(){d._images||(d._images={});var e='<img id="amp-'+a+'" src="'+l.src+'" width="'+d.config.map.size.width+'" height="'+d.config.map.size.height+'" style="position:absolute;">';d._contentTarget.ext.append(e);var g=n.select("#amp-"+a);g&&b&&(d._images[a]=g),d._currentImage&&d._currentImage.ext&&d._currentImage.ext.hide(),d._currentImage=g,d.trigger("load:image",{date:new Date(a),src:l.src}),d.trigger("load:progress",{time:a,loaded:f(d._images).length,total:d._intervals}),c&&c()}}(this)},a.AerisMaps.Animation=o;for(var p,q="aerismaps-animation.css",r=n.select("link"),s=!0,t=new RegExp(q),u=0,v=r.length;v>u;u++)if(p=r[u],t.test(p.href)){s=!1;break}s&&n.select("head").ext.append('<link href="//cdn.aerisapi.com/css/'+q+'" rel="stylesheet" type="text/css"/>')}(window,document);